<div class="container">
    <h2>Liste d'utilisateurs</h2>
    <p *ngIf="errorMessage" class="error-message">{{ errorMessage }}</p>

    <!-- Barre de recherche -->
    <div class="search-bar">
        <input
            type="text"
            [(ngModel)]="searchQuery"
            (input)="filterUsers()"
            placeholder="Rechercher un utilisateur..."
        />
    </div>
    <button routerLink="/register" class="reg-button">Ajouter un utilisateur</button>
    <ng-container *ngTemplateOutlet="userTable; context: {
        title: 'ğŸ‘¤ Tous les Utilisateurs',
        users: paginatedUsers,
        page: usersPage,
        total: totalPagesUsers,
        changePage: changePageUsers
      }"></ng-container>
    <ng-container *ngTemplateOutlet="userTable; context: {
        title: 'ğŸ›¡ï¸ Administrateurs',
        users: paginatedAdmins,
        page: adminsPage,
        total: totalPagesAdmins,
        changePage: changePageAdmins
      }"></ng-container>
    <ng-container *ngTemplateOutlet="userTable; context: {
        title: 'ğŸ§‘â€ğŸ’¼ Agents',
        users: paginatedAgents,
        page: agentsPage,
        total: totalPagesAgents,
        changePage: changePageAgents
      }"></ng-container>
      
      
      
     
      
    <!-- Tableau des utilisateurs -->
    <ng-template #userTable let-title="title" let-users="users" let-page="page" let-total="total" let-changePage="changePage">
        <h3>{{ title }}</h3>
      
        <table *ngIf="users.length > 0">
          <thead>
            <tr>
              
              <th>PrÃ©nom</th>
              <th>Nom</th>
              <th>Date de naissance</th>
              <th>CIN</th>
              <th>Email</th>
              <th>CivilitÃ©</th>
              <th>Ville</th>
              <th>ActivÃ©</th>
              <th>RÃ´le</th>
              <th>Bloquer</th>
              <th>Modifier</th>
              
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              
              <td>{{ user.name }}</td>
              <td>{{ user.lastname }}</td>
              <td>{{ user.dnaiss }}</td>
              <td>{{ user.cin }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.civility }}</td>
              <td>{{ user.city }}</td>
              <td>{{ user.enabled ? 'Oui' : 'Non' }}</td>
              <td>{{ user.role }}</td>
              <td>
                <button
                  [ngClass]="user.enabled ? 'status-button active' : 'status-button blocked'"
                  (click)="toggleUserStatus(user)"
                >
                  {{ user.enabled ? 'ğŸŸ¢ ActivÃ©' : 'ğŸ”´ BloquÃ©' }}
                </button>
              </td>
              <td><button  class="update-button" (click)="navigateToUpdate(user.id)">Modifier</button></td>
             
            </tr>
          </tbody>
        </table>
      
        <div class="pagination-controls" *ngIf="users.length > 0">
          <button (click)="changePage('prev')">PrÃ©cÃ©dent</button>
          <span>Page {{ page }} / {{ total }}</span>
          <button (click)="changePage('next')">Suivant</button>
        </div>
      </ng-template>
      
          
    <a routerLink="/admin/dashboard" *ngIf="isAdmin"><- dashboard</a>
    <a routerLink="/dashboard" *ngIf="isUser"><- dashboard</a>
</div>