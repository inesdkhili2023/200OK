<section class="breadcrumb">
  <div class="container">
    <h2>Insurances</h2>
    <ul>
      <li><a routerLink="/">Home</a> ></li>
      <li>Insurances</li>
    </ul>
  </div>
</section>

<section class="contact-us">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-10">
        <!-- Insurance List Card -->
        <div class="card mb-4">
          <div class="card-header bg-primary text-white">
            <h2 class="mb-0">Insurances</h2>
          </div>
          <div class="card-body">
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Type</th>
                  <th>Start Date</th>
                  <th>End Date</th>
                  <th>Description</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let insurance of insurances">
                  <td>{{ insurance.insuranceId }}</td>
                  <td>{{ insurance.insuranceType }}</td>
                  <td>{{ insurance.startDate | date }}</td>
                  <td>{{ insurance.endDate | date }}</td>
                  <td>{{ insurance.description }}</td>
                  <td>
                    <button class="btn btn-sm btn-warning me-2" (click)="editInsurance(insurance)">Edit</button>
                    <button class="btn btn-sm btn-danger" (click)="deleteInsurance(insurance.insuranceId!)">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Create Form Card -->
        <div *ngIf="!isEditing; else editForm">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h3 class="mb-0">Add Insurance</h3>
            </div>
            <div class="card-body">
              <form (ngSubmit)="createInsurance()">
                <div class="form-group mb-3">
                  <label for="newType">Type: *</label>
                  <input type="text" id="newType" class="form-control" 
                         [ngClass]="{'is-invalid': submitted && formErrors.insuranceType}"
                         [(ngModel)]="newInsurance.insuranceType" name="newType" required>
                  <div class="invalid-feedback" *ngIf="submitted && formErrors.insuranceType">
                    {{ formErrors.insuranceType }}
                  </div>
                </div>

                <div class="form-group mb-3">
                  <label for="newStartDate">Start Date: *</label>
                  <input type="date" id="newStartDate" class="form-control" 
                         [ngClass]="{'is-invalid': submitted && formErrors.startDate}"
                         [(ngModel)]="newInsurance.startDate" name="newStartDate" required>
                  <div class="invalid-feedback" *ngIf="submitted && formErrors.startDate">
                    {{ formErrors.startDate }}
                  </div>
                </div>

                <div class="form-group mb-3">
                  <label for="newEndDate">End Date: *</label>
                  <input type="date" id="newEndDate" class="form-control" 
                         [ngClass]="{'is-invalid': submitted && formErrors.endDate}"
                         [(ngModel)]="newInsurance.endDate" name="newEndDate" required>
                  <div class="invalid-feedback" *ngIf="submitted && formErrors.endDate">
                    {{ formErrors.endDate }}
                  </div>
                </div>

                <div class="form-group mb-3">
                  <label for="newDescription">Description: *</label>
                  <textarea id="newDescription" class="form-control" rows="3"
                          [ngClass]="{'is-invalid': submitted && formErrors.description}"
                          [(ngModel)]="newInsurance.description" name="newDescription" required></textarea>
                  <div class="invalid-feedback" *ngIf="submitted && formErrors.description">
                    {{ formErrors.description }}
                  </div>
                </div>

                <button type="submit" class="btn btn-success">Create</button>
              </form>
            </div>
          </div>
        </div>
        
        <!-- Edit Form Template -->
        <ng-template #editForm>
          <div class="card">
            <div class="card-header bg-warning text-dark">
              <h3 class="mb-0">Edit Insurance</h3>
            </div>
            <div class="card-body">
              <form (ngSubmit)="updateInsurance()">
                <div class="form-group mb-3">
                  <label for="editType">Type: *</label>
                  <input type="text" id="editType" class="form-control" 
                         [ngClass]="{'is-invalid': editSubmitted && formErrors.insuranceType}"
                         [(ngModel)]="selectedInsurance.insuranceType" name="editType" required>
                  <div class="invalid-feedback" *ngIf="editSubmitted && formErrors.insuranceType">
                    {{ formErrors.insuranceType }}
                  </div>
                </div>

                <div class="form-group mb-3">
                  <label for="editStartDate">Start Date: *</label>
                  <input type="date" id="editStartDate" class="form-control" 
                         [ngClass]="{'is-invalid': editSubmitted && formErrors.startDate}"
                         [(ngModel)]="selectedInsurance.startDate" name="editStartDate" required>
                  <div class="invalid-feedback" *ngIf="editSubmitted && formErrors.startDate">
                    {{ formErrors.startDate }}
                  </div>
                </div>

                <div class="form-group mb-3">
                  <label for="editEndDate">End Date: *</label>
                  <input type="date" id="editEndDate" class="form-control" 
                         [ngClass]="{'is-invalid': editSubmitted && formErrors.endDate}"
                         [(ngModel)]="selectedInsurance.endDate" name="editEndDate" required>
                  <div class="invalid-feedback" *ngIf="editSubmitted && formErrors.endDate">
                    {{ formErrors.endDate }}
                  </div>
                </div>

                <div class="form-group mb-3">
                  <label for="editDescription">Description: *</label>
                  <textarea id="editDescription" class="form-control" rows="3"
                          [ngClass]="{'is-invalid': editSubmitted && formErrors.description}"
                          [(ngModel)]="selectedInsurance.description" name="editDescription" required></textarea>
                  <div class="invalid-feedback" *ngIf="editSubmitted && formErrors.description">
                    {{ formErrors.description }}
                  </div>
                </div>

                <button type="submit" class="btn btn-warning me-2">Update</button>
                <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
              </form>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</section>